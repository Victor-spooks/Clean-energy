<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrinho</title>
  <link rel="stylesheet" href="/css/carrinho.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
</head>
<body>
  <%- include('../partial/header1.ejs') %>
  <main>
    <section class="back-button-container">
  <button class="btn-voltar-plain" onclick="history.back()">
    <i class='bx bx-left-arrow-alt'></i> Voltar
  </button>
</section>

    <br><br><section class="produtos">
      <!-- Produto 1 -->
      <article class="produto-card" data-nome="Resíduos de café" data-preco="700" data-max="5">
        <div class="produto-top">
          <img src="/imagem/residuosdecafe.png" alt="Resíduos de café">
          <div class="produto-info">
            <h3>Resíduos de cafée</h3>
            <p class="localizacao"><i class="fas fa-map-marker-alt"></i> Rio de Janeiro - RJ</p>
            <p>Resíduos de café reciclados, ideais para produção de energia limpa e fertilização do solo.</p>
            <p class="disponivel"><strong>Disponível:</strong> 5 toneladas</p>
            <span class="preco">R$ 700,00</span>
            <nav class="quantidade-controls">
              <button class="quantidade-btn btn-menos">−</button>
              <span class="quantidade-num">1</span>
              <button class="quantidade-btn btn-mais">+</button>
            </nav>
          </div>
        </div>
        <button class="btn-remover">Remover</button>
      </article>

      <!-- Produto 2 -->
      <article class="produto-card" data-nome="Resíduos de Biomassa" data-preco="1200" data-max="8">
        <div class="produto-top">
          <img src="/imagem/cana.png" alt="Resíduos de Biomassa">
          <div class="produto-info">
            <h3>Resíduos de Biomassa</h3>
            <p class="localizacao"><i class="fas fa-map-marker-alt"></i> São Paulo - SP</p>
            <p>Resíduos provenientes da geração de biomassa, ideais para combustíveis renováveis e geração de energia sustentável.</p>
            <p class="disponivel"><strong>Disponível:</strong> 8 toneladas</p>
            <span class="preco">R$ 1.200,00</span>
            <nav class="quantidade-controls">
              <button class="quantidade-btn btn-menos">−</button>
              <span class="quantidade-num">1</span>
              <button class="quantidade-btn btn-mais">+</button>
            </nav>
          </div>
        </div>
        <button class="btn-remover">Remover</button>
      </article>
    </section>

    <!-- Resumo abaixo dos produtos -->
    <aside class="resumo">
      <header>
        <h2>Resumo do Pedido</h2>
      </header>
      <ul class="resumo-lista"></ul>
      <p class="total"></p>
      <a href="/minhascompras">
      <button class="btn-comprar">Finalizar Compra</button>
    </a>
    </aside>
  </main>

  <script>
    function atualizarResumo() {
      const produtos = document.querySelectorAll('.produto-card');
      const resumoLista = document.querySelector('.resumo-lista');
      const totalElement = document.querySelector('.total');
      let total = 0;
      resumoLista.innerHTML = '';
      produtos.forEach(card => {
        const nome = card.dataset.nome;
        const preco = Number(card.dataset.preco);
        const quantidade = Number(card.querySelector('.quantidade-num').textContent);
        if (quantidade > 0) {
          resumoLista.innerHTML += `<li>${nome} - R$ ${preco.toFixed(2)} x${quantidade}</li>`;
          total += preco * quantidade;
        }
      });
      totalElement.textContent = `Total: R$ ${total.toFixed(2)}`;
    }

    document.querySelectorAll('.btn-mais').forEach(btn => {
      btn.addEventListener('click', function () {
        const card = this.closest('.produto-card');
        const max = Number(card.dataset.max);
        const num = this.parentElement.querySelector('.quantidade-num');
        const atual = Number(num.textContent);
        if (atual < max) {
          num.textContent = atual + 1;
          atualizarResumo();
        } else {
          alert(`Limite máximo atingido: ${max} unidades.`);
        }
      });
    });

    document.querySelectorAll('.btn-menos').forEach(btn => {
      btn.addEventListener('click', function() {
        const num = this.parentElement.querySelector('.quantidade-num');
        if (Number(num.textContent) > 1) {
          num.textContent = Number(num.textContent) - 1;
          atualizarResumo();
        }
      });
    });

    document.querySelectorAll('.btn-remover').forEach(btn => {
      btn.addEventListener('click', function() {
        this.closest('.produto-card').remove();
        atualizarResumo();
      });
    });

    atualizarResumo();
  </script>
  <%- include('../partial/footer.ejs') %>
</body>
</html>
